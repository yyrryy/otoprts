{% extends 'base.html' %}

{% load static %}
{% block css %}
<style>
  .products-list__item:hover {
    box-shadow: -1px 3px 9px 2px #d9d9d9
  }
</style>
{% endblock %}

{% block content %}
<!-- confirm order fixed at the bottom -->

<!--question Modal -->
<div class="modal fade" id="questionmodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
	  <div class="modal-content">
		<div class="modal-header">
		  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			<span aria-hidden="true">&times;</span>
		  </button>
		</div>
		<div class="modal-body">
      <p class="text-center">
        سؤال عن المنتج
      </p>
			<div class="accordion mb-2" id="accordionExample">
				<div class="accordion-item">
				  
				  <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
					<div class="accordion-body">
						<form id="questionform">
							{% csrf_token %}
							<div class="form-group">
								<label for="exampleInputEmail1">ref</label>
								<input readonly name="ref" type="text" required class="form-control">
							</div>
							
							<div class="form-group">
								<label for="exampleInputPassword1">question</label>
								<textarea name="question" class="form-control" rows="15"></textarea>
							</div>
							
              <input type="text" hidden name="phone" value="{{request.user.client.phone}}">
              <input type="text" hidden name="client" value="{{request.user.client.name}}">

							<button  class="btn btn-primary addclientbtn w-100 mt-3">Submit</button>
					  </form>
					</div>
				  </div>
				</div>
			</div>
			
		</div>
	  </div>
	</div>
</div>
<div class="col-12 shadow rounded p-2 categorytitle fixed-bottom container" style="
  background: lightgray;">
    <!-- <div class="d-flex justify-content-between align-items-center">
      <a href="/catalog" class="bi bi-arrow-left me-2 btn text-primary">Catalog</a>
      <div>
        {{category.title.upper}}
      </div>


      
      
    </div> -->

      <div class="d-flex justify-content-between align-items-center">
          <a href="/catalog" class="btn btn-primary">
            ←
          </a>
          <div class="d-flex col-8">
            <input type="text" placeholder="Chercher Model/Voiture ..." aria-describedby="button-addon1" class="form-control border bg-light" id="searchbox">
            <svg xmlns="http://www.w3.org/2000/svg" id="b2448b99-d97f-419e-8dc3-d5510f0392fe" data-name="Layer 1" width="72" height="47" viewBox="0 0 709.53268 558.59384" class="injected-svg ClassicGrid__ImageFile-sc-td9pmq-4 fNAcXv grid_media" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M664.81368,212.24945a135.01972,135.01972,0,1,0,7.65509,199.4028L838.08687,551.4a12.44209,12.44209,0,0,0,16.06592-19.00287l-.01831-.01544L688.51631,392.63391A135.02729,135.02729,0,0,0,664.81368,212.24945ZM654.13692,379.17712a101.15765,101.15765,0,1,1-12.0766-142.54788l.00006,0A101.15764,101.15764,0,0,1,654.13692,379.17712Z" transform="translate(-245.23366 -170.70308)" fill="#3f3d56"></path></svg>
          </div>
        <div class="position-relative">
          <a href="/cart" class="">
            <span class="">
              <svg width="32" height="32">
                <circle cx="10.5" cy="27.5" r="2.5"></circle>
                <circle cx="23.5" cy="27.5" r="2.5"></circle>
                <path d="M26.4,21H11.2C10,21,9,20.2,8.8,19.1L5.4,4.8C5.3,4.3,4.9,4,4.4,4H1C0.4,4,0,3.6,0,3s0.4-1,1-1h3.4C5.8,2,7,3,7.3,4.3
      l3.4,14.3c0.1,0.2,0.3,0.4,0.5,0.4h15.2c0.2,0,0.4-0.1,0.5-0.4l3.1-10c0.1-0.2,0-0.4-0.1-0.4C29.8,8.1,29.7,8,29.5,8H14
      c-0.6,0-1-0.4-1-1s0.4-1,1-1h15.5c0.8,0,1.5,0.4,2,1c0.5,0.6,0.6,1.5,0.4,2.2l-3.1,10C28.5,20.3,27.5,21,26.4,21z"></path>
              </svg>
              <span class="indicator__counter commanditems">0</span>
            </span>
          </a>        
        </div>
        
      </div>
  </div>
<div class="container" style="margin-bottom: 5rem;">
  <!-- products holder -->
  <div class="products-view__list products-list products-list--grid--4 position-relative" data-layout="list" data-with-features="false">

  <!-- title holder -->
  
    <div class="products-list__content">
        {% for i in products %}
        <div class="products-list__item col-md-9 col-12 mb-2">
          <div class="border rounded product-card">
            <div class="product-card__image">
              
              <div class="image image--type--product text-center">
                <img src="{{i.mark.image}}" width="70">
                <img  src="{{i.image}}" alt="{{ i.name }}" loading="lazy" style="width: 100%;" data-toggle="modal" data-target="#imagedisplaymodal" class="imagedisplaybtn" imgsrc="{{i.image}}">

              </div>
              <div class="status-badge status-badge--style--success product-card__fit status-badge--has-icon status-badge--has-text">
              </div>
            </div>
            <div class="product-card__info">
              <div class="product-card__meta">
                <span class="product-card__meta-title">REF:</span> {{i.ref.upper}}
              </div>
              <div class="product-card__name">
                <div class="">
                    <p>
                      {{i.name.upper}} - {{ i.ref.upper }}
                    </p>

                </div>
                <div class="d-flex flex-column">
                  <div class="d-flex justify-content-between">
                    {% if i.stock %}
                    <div class="status-badge status-badge--style--success status-badge--has-icon status-badge--has-text"><div class="status-badge__body"><div class="status-badge__icon"><svg width="13" height="13"><path d="M12,4.4L5.5,11L1,6.5l1.4-1.4l3.1,3.1L10.6,3L12,4.4z"></path></svg></div><div class="status-badge__text">In Stock</div><div class="status-badge__tooltip" tabindex="0" data-toggle="tooltip" title="" data-original-title="In Stock"></div></div></div>
                  {% else %}
                  <div class="status-badge status-badge--style--failure status-badge--has-icon status-badge--has-text"><div class="status-badge__body"><div class="status-badge__icon"><svg width="13" height="13"><path d="M6.5,0C2.9,0,0,2.9,0,6.5S2.9,13,6.5,13S13,10.1,13,6.5S10.1,0,6.5,0z M6.5,2c0.9,0,1.7,0.3,2.4,0.7L2.7,8.9
                    C2.3,8.2,2,7.4,2,6.5C2,4,4,2,6.5,2z M6.5,11c-0.9,0-1.7-0.3-2.4-0.7l6.2-6.2C10.7,4.8,11,5.6,11,6.5C11,9,9,11,6.5,11z"></path></svg></div><div class="status-badge__text">No Stock</div><div class="status-badge__tooltip" tabindex="0" data-toggle="tooltip" title="" data-original-title="No Stock"></div></div></div>
                  {% endif %}
                  <button class="btn askbtn" data-id="{{i.category.title}} {{i.ref}}" data-toggle="modal" data-target="#questionmodal">
                    <i class="bi bi-question"></i>
                  </button>
                  </div>
                  <div class="d-flex justify-content-between">
                    {% if i.isoffer %}
                    <div class="tag-badge tag-badge--new">{{i.offre}}</div>
                    {% endif %}
                    {% if i.min %}
                    <div class="tag-badge tag-badge--hot">{{i.min}} PCS</div>
                    {% endif %}
                  </div>
                </div>
              </div>
              
              
            </div>
            <div class="product-card__footer d-flex flex-column">

              <div class="product-card__prices p-2 border w-100 mt-2">
                <div class="product-card__price product-card__price--current ">
                  {{i.price}} Net
                </div>

              </div>
              <div class="cart-table__quantity input-number mb-3"><input readonly class="form-control input-number__input qty" type="number" min="{%if i.min%}{{i.min}}{%else%}1{%endif%}" value="{%if i.min%}{{i.min}}{%else%}1{%endif%}"><div class="input-number__add"></div><div class="input-number__sub"></div></div>
          <button class="btn btn-primary cmnd w-100" pdct="{{i.id}}" pdctref="{{i.ref}}" pdctname="{{i.name}}" pdctpr="{{i.price}}" pdctid="{{i.id}}" pdctimg="{{i.image}}" pdctmin="{{i.min}}" pdctcategory="{{i.category.title}}">Cmnd</button>
            </div>
            
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

   <!-- cart 
   <div class="col-md-4 borders cartdd">
  <div class="sticky-top card-header text-center d-flex justify-content-between align-items-center">
    <small>
        Bon de commande
    </small>
    <button class="btn clearcommande bi bi-trash-fill text-danger" onclick="clearcommande()">
    </button>
  </div>
    <div class="col-5 fitscreen bg-white shadow rounded px-2 w-100">
    
    
    <table class="table table-striped table-bordered table-hover">
        <thead>
        <tr>
            <th >ref</th>
            <th >article</th>
            <th style="width: 5%;">Qty</th>
            <th style="width: 5%;">total</th>
        </tr>
        </thead>
        <tbody class="commande-table">
            
        </tbody>
    </table>
    
    </div>
    
</div>-->
</div>
  
{% endblock %}

{% block js %}
<script src="{% static 'js/catalog.js' %} "></script>

<script>
  $('.askbtn').each((i, el)=>{
    $(el).on('click', ()=>{
      $('[name=ref]').val($(el).data('id'))
    })
  })
  var form = document.getElementById('questionform');
   $('.addclientbtn').on('click', function(e){
        
        e.preventDefault();
        const scriptURL='https://script.google.com/macros/s/AKfycbysYBeRsdX8zbXzloiRkigWUsnAC0NWwtLUzcZGsoerf_VvLRBsdvVMi4LYjJYU5J90/exec'
        if ($('[name=question]').val()=='' ){
            alert('Veuillez remplir tous les champs');
        }
        else{
            $(this).addClass('disabled')
            $(this).text('En cours ...')
            fetch(scriptURL, { method: 'POST', body: new FormData(form)})
            .then(response => {
            alert('Votre demande a été envoyée avec succès');
            // hide modal
          $('#questionmodal').modal('hide')

            })
            .catch(error => {
                alert('ERROR');
                // redierct to home
                location.reload 
            }) 
        }
   }) 
</script>
{% endblock %}